@inherits AppComponentBase

@* @if (isOtpSent || requiresTwoFactor)
{
    <!-- Check out ShowSignInPanel's comments -->
    <NavigationLock OnBeforeInternalNavigation="HideTfaAndOtpPanels" />
} *@

<section class="signin-container">
    <div class="signin-card">
        <div class="signin-header">
            <div class="logo-container">
                <img src="@(CurrentTheme == AppThemeType.Dark ? "_content/SRAAI.Client.Core/images/Annexurelogo.png" : "_content/SRAAI.Client.Core/images/Annexurelogo.png")"
                     alt="SRAAI Logo" 
                     class="signin-logo" />
            </div>
            <BitText Typography="BitTypography.H3" Class="signin-title">
                SignIn
            </BitText>
          @*   <BitText Typography="BitTypography.Body1" Color="BitColor.SecondaryForeground" Class="signin-subtitle">
                Welcome back! Please sign in to your account
            </BitText> *@
        </div>

        <EditForm Model="model" OnSubmit="WrapHandled(DoSignIn)" novalidate class="signin-form">
            <AppDataAnnotationsValidator @ref="validatorRef" />

            <div class="signin-content">
                @if (requiresTwoFactor is false)
                {
                    @if (isOtpSent is false)
                    {
                        <div class="form-container">

                            <div class="form-fields">
                                <div class="input-group">
                                    <BitTextField @bind-Value="model.Email"
                                                  TabIndex="1"
                                                  Type="BitInputType.Email"
                                                  Immediate DebounceTime="500"
                                                  Label="@Localizer[nameof(AppStrings.UserName)]"
                                                  Placeholder="@Localizer[nameof(AppStrings.UserNamePlaceholder)]"
                                                  Class="form-input" />
                                    <ValidationMessage For="@(() => model.Email)" Class="validation-message" />
                                </div>

                                @if (internalSignInPanelType is SignInPanelType.Full or SignInPanelType.Password)
                                {
                                    <div class="input-group">
                                        <BitTextField @bind-Value="model.Password"
                                                      TabIndex="2"
                                                      CanRevealPassword="true"
                                                      Type="BitInputType.Password"
                                                      AutoComplete="@BitAutoCompleteValue.CurrentPassword"
                                                      Placeholder="@Localizer[nameof(AppStrings.PasswordPlaceholder)]"
                                                      Class="form-input">
                                            <LabelTemplate>
                                                <div class="password-label">
                                                    <BitText>@Localizer[nameof(AppStrings.Password)]</BitText>
                                                    @* <BitLink Href="@($"{PageUrls.ForgotPassword}?return-url={Uri.EscapeDataString(GetReturnUrl())}")" 
                                                             Class="forgot-password-link">
                                                        @Localizer[nameof(AppStrings.ForgotPasswordLink)]
                                                    </BitLink> *@
                                                </div>
                                            </LabelTemplate>
                                        </BitTextField>
                                        <ValidationMessage For="@(() => model.Password)" Class="validation-message" />
                                    </div>
                                }
                            </div>

                            <div class="form-options">
                                <div class="remember-me-section">
                                    <BitCheckbox @bind-Value="model.RememberMe" 
                                                  Label="@Localizer[nameof(AppStrings.RememberMe)]" 
                                                  Class="remember-me-checkbox" />
                                    @if (showWebAuthn)
                                    {
                                        <BitButton IconOnly
                                                   Size="BitSize.Large"
                                                   IsLoading="isWaiting"
                                                   Variant="BitVariant.Text"
                                                   Color="BitColor.Tertiary"
                                                   IsEnabled="isWaiting is false"
                                                   ButtonType="BitButtonType.Button"
                                                   IconName="@BitIconName.Fingerprint"
                                                   OnClick="WrapHandled(PasswordlessSignIn)"
                                                   Class="biometric-button"
                                                   Title="Sign in with biometric" />
                                    }
                                </div>
                            </div>

                            @if (internalSignInPanelType is SignInPanelType.Full or SignInPanelType.Password)
                            {
                                <div class="submit-section">
                                    @if (internalSignInPanelType is SignInPanelType.Password)
                                    {
                                        <div class="password-message">
                                            <BitText Typography="BitTypography.Body2" Align="BitTextAlign.Center">
                                                <strong>@Localizer[nameof(AppStrings.SignInPasswordMessage1)]</strong>
                                                <br />
                                                @Localizer[nameof(AppStrings.SignInPasswordMessage2)]
                                            </BitText>
                                        </div>
                                    }
                                    <BitButton IsLoading="isWaiting"
                                               IsEnabled="isWaiting is false"
                                               ButtonType="BitButtonType.Submit"
                                               Class="signin-button">
                                        @Localizer[nameof(AppStrings.Continue)]
                                    </BitButton>
                                </div>
                            } 

                        </div>
                    }
                    else
                    {
                        <div class="otp-container">
                            <OtpPanel Model="model"
                                      OnSignIn="DoSignIn"
                                      IsWaiting="isWaiting"
                                      OnResendOtp="WrapHandled(() => SendOtp(resend:true))" />
                        </div>
                    }
                }
                else
                {
                    <div class="tfa-container">
                        <TfaPanel model="model"
                                  IsWaiting="isWaiting"
                                  OnTokenProvided="DoSignIn"
                                  OnSendTfaToken="WrapHandled(SendTfaToken)" />
                    </div>
                }
            </div>
        </EditForm>

       @*  @if (internalSignInPanelType is SignInPanelType.Full)
        {
            <div class="signin-footer">
                <BitText Align="BitTextAlign.Center" Typography="BitTypography.Body2" Class="signup-message">
                    @Localizer[nameof(AppStrings.DontHaveAccountMessage)]
                    <BitLink Href="@($"{PageUrls.SignUp}?return-url={Uri.EscapeDataString(GetReturnUrl())}")" 
                             Class="signup-link">
                        @Localizer[nameof(AppStrings.SignUp)]
                    </BitLink>
                </BitText>
            </div>
        } *@
    </div>
</section>
