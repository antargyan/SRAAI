@attribute [Route(PageUrls.AddOrEditUserPage + "/{Id:guid?}")]
@attribute [Route("{culture?}" + PageUrls.AddOrEditUserPage + "/{Id:guid?}")]
@attribute [Authorize(Policy = AuthPolicies.PRIVILEGED_ACCESS)]
@inherits AppPageBase

<PageTitle>
    @if (user.Id == default)
    {
        @Localizer[nameof(AppStrings.AddUser)]
    }
    else
    {
        @Localizer[nameof(AppStrings.EditUser)]
    }
</PageTitle>

<section class="user-form-container">
    <div class="form-header">
        <div class="header-content">
            <BitButton Variant="BitVariant.Text"
                       Href="@PageUrls.UsersPage"
                       IconName="@BitIconName.Back"
                       Title="@Localizer[nameof(AppStrings.Back)]"
                       Class="back-btn" />
            <div class="header-text">
                <h2 class="form-title">
                    @if (user.Id == default)
                    {
                        @Localizer[nameof(AppStrings.AddUser)]
                    }
                    else
                    {
                        @Localizer[nameof(AppStrings.EditUser)]
                    }
                </h2>
                <p class="form-subtitle">
                    @if (user.Id == default)
                    {
                        <text>Create a new user account</text>
                    }
                    else
                    {
                        <text>Update user information</text>
                    }
                </p>
            </div>
        </div>
    </div>

    <div class="form-wrapper">
        <div class="form-card">
            <EditForm Model="user" OnValidSubmit="WrapHandled(Save)" novalidate>
                <AppDataAnnotationsValidator />

                <div class="form-content">
                    @if (isLoading)
                    {
                        <div class="loading-overlay">
                            <BitEllipsisLoading />
                        </div>
                    }

                    <div class="form-fields">
                        <div class="field-group">
                            <BitTextField @bind-Value="user.FullName"
                                          Label="@Localizer[nameof(AppStrings.FullName)]"
                                          Placeholder="@Localizer[nameof(AppStrings.EnterFullName)]"
                                          Class="form-field" />
                            <ValidationMessage For="() => user.FullName" />
                        </div>

                        <div class="field-group">
                            <BitTextField @bind-Value="user.Email"
                                          Label="@Localizer[nameof(AppStrings.Email)]"
                                          Placeholder="@Localizer[nameof(AppStrings.EnterEmail)]"
                                          Class="form-field" />
                            <ValidationMessage For="() => user.Email" />
                        </div>

                        @if (user.Id == default)
                        {
                            <div class="field-group">
                                <BitTextField @bind-Value="user.Password"
                                              Label="@Localizer[nameof(AppStrings.Password)]"
                                              Placeholder="@Localizer[nameof(AppStrings.Password)]"
                                              Class="form-field" />
                                <ValidationMessage For="() => user.Password" />
                            </div>
                        }
                    </div>

                    <div class="form-actions">
                        <BitButton ButtonType="BitButtonType.Button"
                                   Href="@PageUrls.UsersPage"
                                   Variant="BitVariant.Outline"
                                   Class="cancel-btn">
                            @Localizer[nameof(AppStrings.Cancel)]
                        </BitButton>
                        <BitButton IsLoading="isSaving" 
                                   ButtonType="BitButtonType.Submit"
                                   Class="save-btn">
                            @Localizer[nameof(AppStrings.Save)]
                        </BitButton>
                    </div>
                </div>
            </EditForm>
        </div>
    </div>
</section>